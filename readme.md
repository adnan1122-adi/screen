
# Classroom Digital Signage (Next.js + Supabase + Cloudinary)

A full-stack digital signage solution built with Next.js 15, Supabase (Postgres/Realtime), and Cloudinary.

## ðŸ›  Tech Stack
- **Framework**: Next.js 15 (App Router)
- **Database & Realtime**: Supabase
- **Media**: Cloudinary (Signed Uploads)
- **Styling**: Tailwind CSS
- **Deployment**: Vercel

## ðŸš€ Quick Start

### 1. Supabase Setup
1. Create a project at [supabase.com](https://supabase.com).
2. Go to **SQL Editor** and run the following script to create tables and security policies:

```sql
-- TABLES
create table screens (
  id text primary key,
  name text not null,
  timezone text default 'UTC',
  last_seen timestamp with time zone,
  settings jsonb default '{}'::jsonb
);

create table schedules (
  id bigint generated by default as identity primary key,
  screen_id text references screens(id) on delete cascade,
  weekday smallint not null, -- 1=Mon, 7=Sun
  period integer not null,
  teacher text,
  start_time time not null,
  end_time time not null
);

create table assets (
  id uuid default gen_random_uuid() primary key,
  screen_id text references screens(id) on delete cascade,
  type text check (type in ('image', 'video')),
  url text not null,
  public_id text, -- Cloudinary ID
  duration integer default 10,
  "order" integer default 0
);

create table commands (
  id uuid default gen_random_uuid() primary key,
  screen_id text, -- null means broadcast to all
  cmd text not null,
  payload jsonb,
  created_at timestamp with time zone default now()
);

-- REALTIME
alter publication supabase_realtime add table commands;
alter publication supabase_realtime add table assets;
alter publication supabase_realtime add table schedules;

-- SECURITY (RLS)
alter table screens enable row level security;
alter table schedules enable row level security;
alter table assets enable row level security;
alter table commands enable row level security;

-- Public Read Access (for Screens)
create policy "Public read screens" on screens for select using (true);
create policy "Public read schedules" on schedules for select using (true);
create policy "Public read assets" on assets for select using (true);
create policy "Public read commands" on commands for select using (true);

-- Admin Write Access (Authenticated Users only)
create policy "Admin all screens" on screens for all using (auth.role() = 'authenticated');
create policy "Admin all schedules" on schedules for all using (auth.role() = 'authenticated');
create policy "Admin all assets" on assets for all using (auth.role() = 'authenticated');
create policy "Admin insert commands" on commands for insert using (auth.role() = 'authenticated');
```

### 2. Cloudinary Setup
1. Create a free account at [cloudinary.com](https://cloudinary.com).
2. Go to **Settings > Upload**.
3. Add an "Upload Preset" named `signage_preset` (Mode: Signed).
4. Get your Cloud Name, API Key, and API Secret from the dashboard.

### 3. Environment Variables (.env.local)
Create a `.env.local` file with the following:

```env
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=your-cloud-name
CLOUDINARY_API_KEY=your-api-key
CLOUDINARY_API_SECRET=your-api-secret
```

### 4. Bulk Schedule Import (CSV Format)
When using the bulk import tool in the dashboard, use this CSV format:
```csv
screen_id,weekday,period,start_time,end_time,teacher
room_101,1,1,08:00,08:50,Mr. Smith
room_101,1,2,09:00,09:50,Ms. Jones
```
*(weekday: 1=Monday, 7=Sunday)*

## ðŸ“± PWA / Kiosk Mode
To run on Android TV/Tablets:
1. Navigate to `/screen/[screenId]` in Chrome.
2. Tap **Menu > Add to Home Screen**.
3. Launch the app from the home screen to enter Fullscreen mode.
4. Enable "Keep Awake" in developer settings or use a Kiosk browser app.

## ðŸ›  Deployment to Vercel
1. Push code to GitHub.
2. Import project into Vercel.
3. Add all the Environment Variables from step 3.
4. Deploy!
